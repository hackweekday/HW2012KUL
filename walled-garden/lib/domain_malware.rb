#!/usr/bin/env ruby

# You might want to change this
# ENV["RAILS_ENV"] ||= "production"
ENV["RAILS_ENV"] ||= "development"

require File.dirname(__FILE__) + "/../../config/application"
Rails.application.require_environment!

$running = true
Signal.trap("TERM") do 
  $running = false
end

while($running) do
  #First to check SOA 
  #case "mname"    { print $_->mname }
  #              case "rname"    { print $_->rname }
  #              case "serial"   { print $_->serial }
  #              case "refresh"  { print $_->refresh }
  #              case "retry"    { print $_->retry }
  #              case "expire"   { print $_->expire }
  #              case "minimum"  { print $_->minimum }
  #Create Category
  cat = RpzCategory.find_by_name("malware")

  if cat.nil?
    cat = RpzCategory.create(:name => "malware")
  end

  File.open("malware.db", "r") do |infile|
    while (line = infile.gets)
      puts "#{line}"
      RpzDomain.create(:rpz_category_id => cat.id, :domain => line, :provider => "http://dns-bh.sagadc.org/")
      #counter = counter + 1
    end
  end



  exit
end
